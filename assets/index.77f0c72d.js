var L=Object.defineProperty;var E=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var D=(e,a,i)=>a in e?L(e,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[a]=i,I=(e,a)=>{for(var i in a||(a={}))R.call(a,i)&&D(e,i,a[i]);if(E)for(var i of E(a))O.call(a,i)&&D(e,i,a[i]);return e};import{u as B,a as G,r as f,j as s,b as t,F as N,V as K,c as z,d as M,e as H,f as J,g as q,h as _,R as $,i as Q,P as U}from"./vendor.9a0685c3.js";const W=function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))d(c);new MutationObserver(c=>{for(const o of c)if(o.type==="childList")for(const y of o.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&d(y)}).observe(document,{childList:!0,subtree:!0});function i(c){const o={};return c.integrity&&(o.integrity=c.integrity),c.referrerpolicy&&(o.referrerPolicy=c.referrerpolicy),c.crossorigin==="use-credentials"?o.credentials="include":c.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function d(c){if(c.ep)return;c.ep=!0;const o=i(c);fetch(c.href,o)}};W();const X=()=>B(),j=G;function T(e){f.exports.useState(0);const[a,i]=f.exports.useState(!1);var d="flex flex-row justify-between p-2 m-1 rounded";return d+=e.inFight&&e.isCurrentTurn&&!a?" bg-secondary":"",s("div",{className:d,draggable:e.inFight&&e.isCurrentTurn,children:[t("p",{onClick:c=>{e.inFight&&i(!a),console.log("Edit mode"+!a)},children:e.character.name}),e.inFight&&!a?t("p",{children:e.initiative}):t("input",{type:"number",min:1,autoComplete:"off",pattern:"\\d*",onBlur:c=>e.onInitiativeEntered(Number(c.target.value)||void 0),className:"bg-secondary rounded px-1 w-20",defaultValue:e.initiative,onClick:c=>c.preventDefault()})]})}function C(e){var a;return s("button",{className:"flex flex-row items-center gap-1 bg-primary rounded p-1 select-none"+((a=e.className)!=null?a:""),onClick:e.enabled===void 0||e.enabled?e.onClick:void 0,children:[e.icon?t("div",{children:e.icon}):t(N,{}),t("p",{children:e.text})]})}function P(e){var a;return s("button",{className:"flex flex-row items-center gap-1 bg-secondary rounded p-1 select-none"+((a=e.className)!=null?a:""),onClick:e.enabled===void 0||e.enabled?e.onClick:void 0,children:[e.icon?t("div",{children:e.icon}):t(N,{}),t("p",{children:e.text})]})}function Y(){const e=j(l=>l.characterReducer.currentParty!==void 0?l.characterReducer.parties[l.characterReducer.currentParty].characters:(console.log(l.characterReducer.currentParty),console.log(l.characterReducer.parties),console.log("No party selected"),[])),[a,i]=f.exports.useState(new Map),[d,c]=f.exports.useState(0),[o,y]=f.exports.useState(!1),F=()=>{o?(i(new Map),c(0),y(!1)):Array.from(a.values()).some(l=>l>0)&&y(!o)},b=e==null?void 0:e.map((l,m)=>({char:l,index:m})).filter(l=>a.get(l.char)===void 0),v=e==null?void 0:e.filter((l,m)=>!o||a.get(l)!==void 0).map((l,m)=>({char:l,init:a.get(l),index:m})).sort((l,m)=>o?m.init-l.init:0);return t("div",{className:"py-2 h-full",children:v&&v.length>0?s("div",{children:[s("div",{className:"mx-4 flex flex-row justify-between",children:[t("p",{className:"text-lg font-bold",children:"Name"}),t("p",{className:"text-lg font-bold",children:"Initiative"})]}),s("div",{children:[t("div",{className:"grow flex flex-col divide-y-2",children:v.map((l,m,S)=>t("div",{children:t(T,{character:l.char,initiative:l.init,inFight:o,isCurrentTurn:m===d%S.length,onInitiativeEntered:h=>{if(h){const g=a.get(l.char),w=a.get(v[d].char);if(h===g)return;(g>w&&h<w||g<w&&h>w)&&(g>h?c(d-1):c(d+1)),i(new Map(a.set(l.char,h)))}else a.delete(l.char)&&i(new Map(a))}},l.char.name)}))}),t("div",{className:"m-auto text-center mt-4",children:o?s("div",{className:"flex flex-col items-center gap-2",children:[t(C,{text:"Advance turn",onClick:()=>c((d+1)%a.size)}),t(P,{text:"Fight finished",onClick:F})]}):t("div",{className:"flex flex-col items-center gap-2 text-xl",children:t(C,{text:"Start Fight",icon:t(K,{}),onClick:F})})}),o&&b&&b.length>0?s("div",{className:"mt-6",children:[t("p",{className:"text-lg font-bold text-center",children:"Not participating"}),t("div",{className:"grow flex flex-col divide-y-2",children:b.map(l=>t(T,{character:l.char,initiative:a.get(l.char),inFight:!1,onInitiativeEntered:m=>{m?(i(new Map(a.set(l.char,m))),Array.from(a).sort((h,g)=>h[1]-g[1])[d][1]<m&&c(d+1)):a.delete(l.char)&&i(new Map(a))}},l.index))})]}):t(N,{})]})]}):t("div",{className:"absolute top-1/2 w-full text-center",children:t("p",{children:"Go to setup and select a current party"})})})}function Z(e){return s("div",{className:"flex flex-col top-0 bottom-0 left-0 right-0 grow max-h-full",children:[e.tabViewItems.map(a=>a.id===e.selectedId?t("div",{className:"grow overflow-y-auto overscroll-contain",children:a.view},a.id):t(N,{})),t("div",{className:"w-full flex flex-row justify-evenly bottom-0 bg-secondary h-10 shrink-0",children:e.tabViewItems.map(a=>t("div",{className:a.id===e.selectedId?"bg-primary p-1 rounded my-auto":"p-1 my-auto",onClick:a.onTabButtonPress,children:a.name},a.id))})]})}var r=(e=>(e[e.Friendly=0]="Friendly",e[e.Enemy=1]="Enemy",e[e.Neutral=2]="Neutral",e))(r||{});Object.entries(r);var n=(e=>(e[e.Pc=0]="Pc",e[e.Npc=1]="Npc",e))(n||{});r.Friendly,n.Pc,r.Friendly,n.Pc,r.Friendly,n.Pc,r.Friendly,n.Pc,r.Friendly,n.Pc,r.Friendly,n.Pc,r.Enemy,n.Npc,r.Friendly,n.Pc,r.Friendly,n.Pc,r.Friendly,n.Pc,r.Friendly,n.Pc,r.Friendly,n.Pc,r.Friendly,n.Pc,r.Friendly,n.Pc,r.Friendly,n.Pc,r.Friendly,n.Pc,r.Friendly,n.Pc,r.Friendly,n.Pc,r.Friendly,n.Pc,r.Friendly,n.Pc,r.Friendly,n.Pc,r.Friendly,n.Pc,r.Friendly,n.Pc,r.Friendly,n.Pc,r.Friendly,n.Pc,r.Friendly,n.Pc,r.Friendly,n.Pc,r.Friendly,n.Pc,r.Friendly,n.Pc,r.Friendly,n.Pc,r.Friendly,n.Pc,r.Friendly,n.Pc,r.Friendly,n.Pc;const ee={currentParty:void 0,parties:[]},A=z({name:"characters",initialState:ee,reducers:{setCurrentParty:(e,a)=>{e.parties[a.payload]&&(e.currentParty=a.payload)},addCharacter:(e,a)=>{var i;(i=e.parties[a.payload.partyIndex])==null||i.characters.push(a.payload.character)},removeCharacter:(e,a)=>{var i;(i=e.parties[a.payload.partyIndex])==null||i.characters.splice(a.payload.characterIndex,1)},addEmptyParty:(e,a)=>{e.parties.push({name:a.payload,characters:[]})},duplicateParty:(e,a)=>{const i=e.parties[a.payload],d={name:"Copy of "+i.name,characters:i.characters.map(c=>I({},c))};e.parties.push(d)},removeParty:(e,a)=>{a.payload===e.currentParty&&(e.currentParty=void 0),e.parties.splice(a.payload,1)}}}),{setCurrentParty:te,addCharacter:ae,removeCharacter:re,addEmptyParty:ne,duplicateParty:le,removeParty:ie}=A.actions;var ce=A.reducer;function se(){const e=X(),a=j(p=>p.characterReducer.parties),[i,d]=f.exports.useState(void 0),[c,o]=f.exports.useState(void 0),[y,F]=f.exports.useState(void 0),[b,v]=f.exports.useState(!1),[l,m]=f.exports.useState(r.Friendly),[S,h]=f.exports.useState(n.Pc),g=()=>{F(void 0),m(0),h(0)},w=(p,x)=>{const u=p===r.Friendly?"text-green-500":p===r.Neutral?"text-neutral-900":"text-red-700";return x===n.Pc?t(J,{className:u}):t(q,{className:u})};return s("div",{className:"flex flex-col h-full",children:[s("div",{className:"text-center flex flex-row justify-around ",children:[t("p",{className:"text-lg font-bold",children:"Parties"}),t(M,{className:"absolute right-4 top-2 scale-125",onClick:p=>{o(c!==void 0?void 0:"")}})]}),c!==void 0?s("div",{className:"flex flex-row content-evenly m-2",children:[t("input",{className:"grow rounded px-1 bg-secondary mr-4",value:c,type:"text",onChange:p=>o(p.target.value)}),t(C,{text:"Create",onClick:()=>{e(ne(c)),o(void 0)}})]}):t(N,{}),a.length>0?t("div",{className:"grow flex flex-col gap-1",children:a.map((p,x)=>s("div",{children:[t("div",{className:"bg-secondary rounded m-2 p-1",onClick:()=>{d(i===x?void 0:x),v(!1),g()},children:p.name}),i===x?t("div",{className:"overflow-hidden",children:s("div",{className:"flex flex-col gap-2 ",children:[!b&&y===void 0?s("div",{className:"flex flex-row gap-1 mx-2 flex-wrap",children:[t(C,{text:"Set as current party",onClick:()=>e(te(x))}),t(P,{text:"Add character",onClick:()=>F(y!==void 0?void 0:"")}),t(P,{text:"Duplicate party",onClick:()=>e(le(x))}),t(P,{text:"Rename party"}),t(P,{text:"Delete party",onClick:()=>v(!0)})]}):t(N,{}),b?s("div",{className:"flex flex-row gap-1 mx-2 justify-evenly",children:[t(P,{text:"Do not delete party",onClick:()=>v(!1)}),t(C,{text:"Delete party",onClick:()=>{e(ie(x)),v(!1),d(void 0)}})]}):t(N,{}),y!==void 0?s("div",{className:"flex flex-col m-2 gap-2",children:[s("div",{className:"flex flex-row gap-2",children:[t("label",{children:"Name"}),t("input",{className:"grow rounded px-1 bg-secondary",value:y,type:"text",onChange:u=>F(u.target.value),autoComplete:"off",list:"autocompleteOff"})]}),s("div",{className:"flex flex-row gap-2",children:[t("label",{children:"Allegiance"}),s("select",{value:l,onChange:u=>m(Number(u.target.value)),className:"bg-secondary rounded",children:[t("option",{value:0,children:"Friendly"}),t("option",{value:1,children:"Enemy"}),t("option",{value:2,children:"Neutral"})]})]}),s("div",{className:"flex flex-row gap-2",children:[t("p",{children:"Type"}),s("select",{value:S,onChange:u=>h(Number(u.target.value)),className:"bg-secondary rounded",children:[t("option",{value:0,children:"PC"}),t("option",{value:1,children:"NPC"})]})]}),s("div",{className:"flex flex-row gap-2",children:[t(C,{text:"Add Character",onClick:()=>{e(ae({partyIndex:x,character:{name:y,allegiance:l,type:S}})),g()}}),t(P,{text:"Cancel",onClick:g})]})]}):t(N,{}),t("div",{className:"flex flex-col divide-y-2",children:p.characters.map((u,V)=>s("div",{className:"flex flex-row justify-between items-center",children:[s("div",{className:"flex flex-row items-center ml-2 gap-2",children:[w(u.allegiance,u.type),t("p",{children:u.name})]}),t("button",{className:"mr-4 select-none",onClick:()=>{e(re({partyIndex:x,characterIndex:V}))},children:t(H,{})})]},u.name))})]})}):t(N,{})]},p.name))}):t("div",{className:"grow flex flex-col items-center justify-center h-full",children:s("div",{className:"flex flex-row items-center justify-center",children:[t("p",{children:"Press"}),t(M,{className:"mx-1"}),t("p",{children:"to add a new party"})]})})]})}function oe(){const[e,a]=f.exports.useState("fight");return t("div",{className:"absolute top-0 bottom-0 left-0 right-0 min-h-full flex flex-col overscroll-none p-safe",children:t(Z,{selectedId:e,tabViewItems:[{name:"Fight",id:"fight",view:t(Y,{}),onTabButtonPress:()=>{a("fight")}},{name:"Setup",id:"setup",view:t(se,{}),onTabButtonPress:()=>{a("setup")}}]})})}function de(){try{const e=localStorage.getItem("state");return e===null?void 0:JSON.parse(e)}catch{return}}function me(e){try{const a=JSON.stringify(e);localStorage.setItem("state",a)}catch{}}const k=_({reducer:{characterReducer:ce},preloadedState:de()});k.subscribe(()=>{me(k.getState())});$.render(t(Q.StrictMode,{children:t(U,{store:k,children:t(oe,{})})}),document.getElementById("root"));
